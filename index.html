<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>XROT 95 EVO | Command Node</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#050505">

    <!-- Fonty a Ikony -->
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Externí Styly -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Knihovny -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>

    <!-- HLAVIČKA -->
    <header class="hud-header">
        <div class="header-row-top">
            <div class="brand">
                <h1>XROT <span>95 EVO</span></h1>
                <div class="status">
                    <div id="status-dot" class="status-dot warn"></div> 
                    <span id="system-status">INITIALIZING...</span>
                </div>
            </div>
            <div class="meteo-box" id="meteo-widget"><i class="fas fa-satellite"></i> Načítám data...</div>
        </div>
        
        <div class="sensor-row">
            <div class="sensor-tile">
                <span class="sensor-label">GPS RTK [Zdroj: 1]</span>
                <span class="sensor-val" id="rtk-val" style="color:var(--accent)">FLOAT</span>
            </div>
            <div class="sensor-tile">
                <span class="sensor-label">SVAH (Max 45°) [Zdroj: 3]</span>
                <span class="sensor-val" id="tilt-val">0°</span>
            </div>
            <div class="sensor-tile">
                <span class="sensor-label">TLAK NA PŮDU [Zdroj: 3]</span>
                <span class="sensor-val">171g/cm²</span>
            </div>
        </div>
    </header>

    <!-- HLAVNÍ DASHBOARD -->
    <div class="grid-container" id="dashboard-view">
        
        <!-- Sekce Moduly -->
        <div class="card" style="--c:var(--danger)" onclick="openMod('mod-crisis')">
            <div class="card-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="card-title">KRIZOVÁ DIAGNOSTIKA</div>
            <div class="card-sub">Hydrolock & Chybové kódy</div>
        </div>
        
        <div class="card" style="--c:var(--success)" onclick="openMod('mod-gps')">
            <div class="card-icon"><i class="fas fa-map-marked-alt"></i></div>
            <div class="card-title">RTK & DIGITÁLNÍ DVOJČE</div>
            <div class="card-sub">CZEPOS & Export Tras</div>
        </div>
        
        <div class="card" style="--c:var(--primary)" onclick="openMod('mod-tele')">
            <div class="card-icon"><i class="fas fa-chart-area"></i></div>
            <div class="card-title">TELEMETRIE</div>
            <div class="card-sub">Live CAN-Bus Data</div>
        </div>
        
        <div class="card" style="--c:var(--purple)" onclick="openMod('mod-acc')">
            <div class="card-icon"><i class="fas fa-cubes"></i></div>
            <div class="card-title">PŘÍSLUŠENSTVÍ</div>
            <div class="card-sub">MiXTY, Flex, Snow</div>
        </div>

        <!-- NOVÁ KARTA SERVISNÍ KNIHY -->
        <div class="card" style="--c:var(--accent)" onclick="ServiceBook.open()">
            <div class="card-icon"><i class="fas fa-book-medical"></i></div>
            <div class="card-title">SERVISNÍ KNIHA</div>
            <div class="card-sub">Evidence, MTH & Údržba</div>
        </div>

    </div>

    <!-- === MODULY === -->

    <!-- 1. KRIZOVÁ DIAGNOSTIKA -->
    <div class="module" id="mod-crisis">
        <div class="mod-head" onclick="toggleMod(this)">
            <div class="mod-title"><i class="fas fa-heartbeat mod-icon"></i> DIAGNOSTIKA & CHYBY (ECU)</div>
            <i class="fas fa-chevron-down mod-chevron"></i>
        </div>
        <div class="mod-body">
            <div class="alert-box">
                <i class="fas fa-radiation alert-icon"></i>
                <div>
                    <strong style="color:var(--danger)">CHYBA 107: PŘEVRÁCENÍ (HYDROLOCK)</strong><br>
                    <small>Motor nouzově vypnut (>65°). Olej může být ve válcích.</small><br>
                    <strong>POVINNÝ POSTUP:</strong>
                    <ol style="margin-left:20px; font-size:13px; margin-top:5px">
                        <li>Postavit stroj na pásy. Čekat 30 min.</li>
                        <li><strong>VYŠROUBOVAT SVÍČKY!</strong> (Nestartovat!)</li>
                        <li>Protočit motor startérem (5x 5s).</li>
                        <li>Vrátit svíčky, zkontrolovat olej.</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. RTK & GPS -->
    <div class="module" id="mod-gps">
        <div class="mod-head" onclick="toggleMod(this)">
            <div class="mod-title"><i class="fas fa-satellite mod-icon"></i> RTK & CZEPOS</div>
            <i class="fas fa-chevron-down mod-chevron"></i>
        </div>
        <div class="mod-body">
            <div style="background:rgba(0,255,157,0.05); padding:15px; border-radius:8px; border:1px solid var(--success);">
                <strong style="color:var(--success)">RTK STATUS: <span id="gps-status-text">FLOAT</span></strong>
                <div style="font-size:11px; margin-top:8px; color:var(--text-muted); font-family:'JetBrains Mono'">
                    IP: czepos.cuzk.cz | Port: 2101 | Mount: VRS_RTCM32
                </div>
            </div>
        </div>
    </div>

    <!-- 3. TELEMETRIE -->
    <div class="module" id="mod-tele">
        <div class="mod-head" onclick="toggleMod(this)">
            <div class="mod-title"><i class="fas fa-microchip mod-icon"></i> LIVE TELEMETRIE</div>
            <i class="fas fa-chevron-down mod-chevron"></i>
        </div>
        <div class="mod-body">
            <canvas id="teleChart" style="width:100%; height:200px; margin-bottom: 20px;"></canvas>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                <div><small>RPM</small><div id="val-rpm" style="color:var(--primary); font-size:20px; font-weight:bold;">0</div></div>
                <div><small>TEPLOTA</small><div id="val-temp" style="color:var(--accent); font-size:20px; font-weight:bold;">0°C</div></div>
                <div><small>ZATÍŽENÍ</small><div id="val-load" style="color:var(--purple); font-size:20px; font-weight:bold;">0%</div></div>
                <div><small>NAPĚTÍ</small><div id="val-volt" style="color:var(--success); font-size:20px; font-weight:bold;">0V</div></div>
            </div>
        </div>
    </div>

    <!-- 4. PŘÍSLUŠENSTVÍ -->
    <div class="module" id="mod-acc">
        <div class="mod-head" onclick="toggleMod(this)">
            <div class="mod-title"><i class="fas fa-plug mod-icon"></i> PŘÍSLUŠENSTVÍ</div>
            <i class="fas fa-chevron-down mod-chevron"></i>
        </div>
        <div class="mod-body">
            <div style="border-left:3px solid var(--primary); padding-left:10px; margin-bottom:10px;">
                <strong>MiXTY Postřikovač</strong><br><small>100L nádrž, 3 trysky.</small>
            </div>
            <div style="border-left:3px solid var(--accent); padding-left:10px;">
                <strong>Flex Cut</strong><br><small>Boční sečení 420mm.</small>
            </div>
        </div>
    </div>

    <!-- 5. SERVISNÍ KNIHA (NOVÝ MODUL) -->
    <div class="module" id="mod-service-book">
        <div class="mod-head" onclick="toggleMod(this)">
            <div class="mod-title"><i class="fas fa-book-medical mod-icon"></i> DIGITÁLNÍ SERVISNÍ KNIHA</div>
            <i class="fas fa-chevron-down mod-chevron"></i>
        </div>
        <div class="mod-body">
            
            <!-- HORNÍ LIŠTA: STATISTIKY -->
            <div class="stats-panel">
                <div class="stat-box">
                    <span class="stat-label">CELKEM MTH</span>
                    <span class="stat-value" id="total-mth-display">0.0</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">NÁKLADY (ROK)</span>
                    <span class="stat-value text-accent" id="total-cost-display">0 Kč</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">POSLEDNÍ SERVIS</span>
                    <span class="stat-value text-success" id="last-service-date">-</span>
                </div>
            </div>

            <!-- INTERVALY ÚDRŽBY -->
            <div class="maintenance-section">
                <h4 class="section-title">BLÍŽÍCÍ SE INTERVALY</h4>
                <div class="service-progress">
                    <div class="progress-info">
                        <span>Motorový olej (100h)</span>
                        <span class="text-mono" id="countdown-100">---</span>
                    </div>
                    <div class="progress-track"><div class="progress-fill" id="bar-100" style="width: 0%; background: var(--success);"></div></div>
                </div>
                <div class="service-progress">
                    <div class="progress-info">
                        <span>Hydraulika & Filtry (500h)</span>
                        <span class="text-mono" id="countdown-500">---</span>
                    </div>
                    <div class="progress-track"><div class="progress-fill" id="bar-500" style="width: 0%; background: var(--primary);"></div></div>
                </div>
            </div>

            <!-- OVLÁDACÍ TLAČÍTKA -->
            <div class="control-bar">
                <button class="cyber-btn btn-add" onclick="ServiceBook.toggleForm()">
                    <i class="fas fa-plus"></i> NOVÝ ZÁZNAM
                </button>
                <div class="secondary-actions">
                    <button class="cyber-btn-icon" onclick="ServiceBook.exportData()"><i class="fas fa-download"></i></button>
                    <input type="file" id="import-file-book" style="display:none" onchange="ServiceBook.importData(this)">
                    <button class="cyber-btn-icon" onclick="document.getElementById('import-file-book').click()"><i class="fas fa-upload"></i></button>
                </div>
            </div>

            <!-- FORMULÁŘ (Skrytý) -->
            <div id="add-service-form" class="cyber-form hidden">
                <h4 style="color:var(--accent); margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:5px;">NOVÝ SERVISNÍ ÚKON</h4>
                <div class="form-grid">
                    <div class="form-group"><label>Datum</label><input type="date" id="book-date" class="cyber-input"></div>
                    <div class="form-group"><label>Stav MTH</label><input type="number" id="book-mth" class="cyber-input" step="0.1" placeholder="0.0"></div>
                    <div class="form-group">
                        <label>Typ úkonu</label>
                        <select id="book-type" class="cyber-input">
                            <option value="check">Běžná kontrola</option>
                            <option value="oil">Výměna oleje</option>
                            <option value="filter">Výměna filtrů</option>
                            <option value="blade">Broušení/Výměna nožů</option>
                            <option value="repair">Oprava / Porucha</option>
                        </select>
                    </div>
                    <div class="form-group"><label>Cena (Kč)</label><input type="number" id="book-cost" class="cyber-input" placeholder="0"></div>
                </div>
                <div class="form-group"><label>Popis / Mechanik</label><textarea id="book-desc" class="cyber-input" rows="2" placeholder="Detaily úkonu..."></textarea></div>
                <div class="form-actions">
                    <button class="cyber-btn btn-save" onclick="ServiceBook.saveRecord()">ULOŽIT DO DB</button>
                    <button class="cyber-btn btn-cancel" onclick="ServiceBook.toggleForm()">ZRUŠIT</button>
                </div>
            </div>

            <!-- HISTORIE -->
            <div class="history-list-container">
                <div class="list-header">
                    <span class="text-muted">HISTORIE ÚKONŮ</span>
                    <select class="mini-select" onchange="ServiceBook.filterList(this.value)">
                        <option value="all">Vše</option>
                        <option value="oil">Oleje</option>
                        <option value="repair">Opravy</option>
                    </select>
                </div>
                <div id="service-list-output"></div>
            </div>
        </div>
    </div>

    <!-- AI Overlay -->
    <div class="ai-overlay" id="aiOverlay">
        <div style="padding:15px; border-bottom:1px solid var(--purple); background:#1a0b2e; display:flex; justify-content:space-between; align-items:center;">
            <strong style="color:var(--purple)"><i class="fas fa-brain"></i> NEURAL CORE</strong>
            <i class="fas fa-times" style="color:#fff; font-size:20px;" onclick="toggleAI()"></i>
        </div>
        <div id="ai-chat-body" class="ai-content">
            <div class="ai-msg bot">Mám data z manuálů. Zeptejte se na "Olej", "Kód 107" nebo "CZEPOS".</div>
        </div>
        <div style="padding:15px; background:var(--bg-deep); border-top:1px solid #333; display:flex; gap:10px;">
            <input type="text" id="ai-input" placeholder="Dotaz..." style="flex:1; padding:12px;" onkeypress="if(event.key==='Enter') sendAI()">
            <button onclick="sendAI()" style="width:50px; background:var(--purple); border:none; border-radius:6px; color:#fff;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div class="fab-stack">
        <div class="fab fab-ai" onclick="toggleAI()"><i class="fas fa-robot"></i></div>
    </div>

    <script src="app.js"></script>
</body>
</html>


