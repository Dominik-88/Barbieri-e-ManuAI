<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>XROT 95 EVO | Command Node</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#050505">

    <!-- Fonty a Ikony -->
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&amp;family=JetBrains+Mono:wght@400;700&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Externí Styly -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Knihovny -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
</head>
<body>

    <header class="hud-header">
        <div class="header-row-top">
            <div class="brand">
                <h1>XROT <span>95 EVO</span></h1>
                <div class="status">
                    <div id="status-dot" class="status-dot warn"></div> 
                    <span id="system-status">INITIALIZING...</span>
                </div>
            </div>
            <div class="meteo-box" id="meteo-widget"><i class="fas fa-sun"></i> 11.6°C | <i class="fas fa-wind"></i> 11.3 km/h</div>
        </div>
        
        <div class="sensor-row">
            <div class="sensor-tile">
                <span class="sensor-label">GPS RTK [Zdroj: 1]</span>
                <span class="sensor-val" id="rtk-val" style="color:var(--accent)">FLOAT</span>
            </div>
            <div class="sensor-tile">
                <span class="sensor-label">SVAH (Max 45°) [Zdroj: 3]</span>
                <span class="sensor-val" id="tilt-val">4°</span>
            </div>
            <div class="sensor-tile">
                <span class="sensor-label">TLAK NA PŮDU [Zdroj: 3]</span>
                <span class="sensor-val">171g/cm²</span>
            </div>
        </div>
    </header>

    <div class="grid-container">
        <div class="card" style="--c:var(--danger)" onclick="openMod('mod-crisis')">
            <div class="card-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="card-title">KRIZOVÁ DIAGNOSTIKA</div>
            <div class="card-sub">Hydrolock &amp; Chybové kódy</div>
        </div>
        
        <div class="card" style="--c:var(--success)" onclick="openMod('mod-gps')">
            <div class="card-icon"><i class="fas fa-map-marked-alt"></i></div>
            <div class="card-title">RTK &amp; DIGITÁLNÍ DVOJČE</div>
            <div class="card-sub">CZEPOS &amp; Export Tras</div>
        </div>
        
        <div class="card" style="--c:var(--accent)" onclick="openMod('mod-service')">
            <div class="card-icon"><i class="fas fa-wrench"></i></div>
            <div class="card-title">SERVIS &amp; KAPALINY</div>
            <div class="card-sub">Intervaly 50h / 100h / 500h</div>
        </div>
        
        <div class="card" style="--c:var(--primary)" onclick="openMod('mod-tele')">
            <div class="card-icon"><i class="fas fa-chart-area"></i></div>
            <div class="card-title">TELEMETRIE</div>
            <div class="card-sub">Live CAN-Bus Data</div>
        </div>
        
        <div class="card" style="--c:var(--purple)" onclick="openMod('mod-acc')">
            <div class="card-icon"><i class="fas fa-cubes"></i></div>
            <div class="card-title">PŘÍSLUŠENSTVÍ</div>
            <div class="card-sub">MiXTY, Flex, Snow</div>
        </div>
    </div>

    <div class="module" id="mod-crisis">
        <div class="mod-head" onclick="toggleMod(this)">
            <div class="mod-title"><i class="fas fa-heartbeat mod-icon"></i> DIAGNOSTIKA &amp; CHYBY (ECU)</div>
            <i class="fas fa-chevron-down mod-chevron"></i>
        </div>
        <div class="mod-body">
            
            <div class="alert-box">
                <i class="fas fa-radiation alert-icon"></i>
                <div>
                    <strong style="color:var(--danger)">CHYBA 107: PŘEVRÁCENÍ (HYDROLOCK RIZIKO)</strong><br>
                    <small>Motor nouzově vypnut (&gt;65°). Olej může být ve válcích.</small><br>
                    <strong>POVINNÝ POSTUP [Zdroj: 6]:</strong>
                    <ol style="margin-left:20px; font-size:13px; margin-top:5px">
                        <li>Bezpečně postavit stroj na pásy. Čekat 30 min.</li>
                        <li><strong>VYŠROUBOVAT SVÍČKY!</strong> (Nepokoušejte se startovat)</li>
                        <li>Protočit motor startérem (5x 5s), aby olej vyletěl otvory svíček.</li>
                        <li>Vrátit svíčky, zkontrolovat olej (SAE 10W-40).</li>
                    </ol>
                </div>
            </div>

            <h4 style="color:var(--text-bright); margin-top:20px; border-bottom:1px solid #333; padding-bottom:5px;">ECU &amp; DRIVER CODES</h4>
            <table class="data-table">
                <tbody><tr><td class="val-danger">101-103</td><td>Chyba komunikace CAN Bus (Restart)</td></tr>
                <tr><td class="val-danger">104</td><td>NOUZOVÉ TLAČÍTKO AKTIVNÍ</td></tr>
                <tr><td class="val-danger">120</td><td>Nízká hladina oleje motoru</td></tr>
                <tr><td class="val-danger">204/304</td><td>Přetížení motoru (Snížit rychlost!)</td></tr>
                <tr><td class="val-danger">206/306</td><td>Nízké napětí 48V (Dobít)</td></tr>
                <tr><td class="val-danger">209/309</td><td>Teplota elektromotoru (Nechat vychladnout)</td></tr>
                <tr><td class="val-danger">130-140</td><td>Porucha driveru (Servis)</td></tr>
            </tbody></table>

            <h4 style="color:var(--text-bright); margin-top:20px; border-bottom:1px solid #333; padding-bottom:5px;">BEACON NET (Vizuální diagnostika)</h4>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
                <div style="background:#111; padding:8px; border-radius:4px; border-left:3px solid #00ff00; color:#fff; font-size:11px;">ZELENÁ: OK / Motor Běží</div>
                <div style="background:#111; padding:8px; border-radius:4px; border-left:3px solid #ffcc00; color:#fff; font-size:11px;">ŽLUTÁ (Bliká): Sečení aktivní (PTO)</div>
                <div style="background:#111; padding:8px; border-radius:4px; border-left:3px solid #ffcc00; color:#fff; font-size:11px;">ŽLUTÁ (Svítí): Svah &gt; 35° (Varování)</div>
                <div style="background:#111; padding:8px; border-radius:4px; border-left:3px solid #ff0000; color:#fff; font-size:11px;">ČERVENÁ: STOP / Chyba / Svah &gt; 45°</div>
                <div style="background:#111; padding:8px; border-radius:4px; border-left:3px solid #fff; color:#fff; font-size:11px;">BÍLÁ: Autonomie připravena</div>
            </div>
        </div>
    </div>

    <div class="module" id="mod-gps">
        <div class="mod-head" onclick="toggleMod(this)">
            <div class="mod-title"><i class="fas fa-satellite mod-icon"></i> RTK AUTONOMIE &amp; CZEPOS</div>
            <i class="fas fa-chevron-down mod-chevron"></i>
        </div>
        <div class="mod-body">
            
            <div style="background:rgba(0,255,157,0.05); padding:15px; border-radius:8px; border:1px solid var(--success);">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong style="color:var(--success)">RTK STATUS: <span id="gps-status-text">FLOAT</span></strong>
                    <i class="fas fa-wifi" style="color:var(--success)"></i>
                </div>
                <div style="font-size:11px; margin-top:8px; color:var(--text-muted); font-family:'JetBrains Mono'">
                    <strong>Nastavení CZEPOS [Zdroj: 1]:</strong><br>
                    IP/HOST: czepos.cuzk.cz<br>
                    PORT: 2101<br>
                    MOUNT: VRS_RTCM32<br>
                    LOGIN: Vaše údaje ČÚZK
                </div>
                <div style="margin-top:10px; font-size:12px; color:var(--text-bright)">
                    <i class="fas fa-info-circle"></i> Autonomie povolena pouze při ZELENÉM (FIXED) statusu (přesnost 1-3 cm). <br>
                    <span style="color:var(--accent)">ORANŽOVÁ (FLOAT) = zákaz ukládání tras.</span>
                </div>
            </div>

            <h4 style="color:var(--text-bright); margin:20px 0 10px;">REŽIMY UČENÍ (COMPASS SERVO) [Zdroj: 1]</h4>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div style="background:#222; padding:10px; border-radius:6px; cursor:pointer" onclick="alert('SHIFT+A (Start) -&gt; SHIFT+B (Konec)')">
                    <div style="color:var(--primary); font-weight:700">MODE 1</div>
                    <div style="font-size:10px; color:#888">Rovnoběžné pruhy (obdélník)</div>
                </div>
                <div style="background:#222; padding:10px; border-radius:6px; cursor:pointer" onclick="alert('SHIFT+A -&gt; Projet křivku -&gt; SHIFT+C')">
                    <div style="color:var(--accent); font-weight:700">MODE 2</div>
                    <div style="font-size:10px; color:#888">Kopírování křivky</div>
                </div>
                <div style="background:#222; padding:10px; border-radius:6px; cursor:pointer" onclick="alert('Automatické řádky 95cm')">
                    <div style="color:var(--success); font-weight:700">S-MODE 4</div>
                    <div style="font-size:10px; color:#888">Vinice / Solární parky</div>
                </div>
                <div style="background:#222; padding:10px; border-radius:6px; cursor:pointer" onclick="alert('SHIFT+A, SHIFT+B...')">
                    <div style="color:#fff; font-weight:700">S-MODE 5</div>
                    <div style="font-size:10px; color:#888">Manuální záznam (Složité)</div>
                </div>
            </div>

            <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
                <strong style="font-size:12px;">EXPORT DIGITÁLNÍHO DVOJČETE</strong>
                <div style="display:flex; gap:10px; margin-top:5px;">
                    <button style="flex:1; padding:8px; background:#1a1f28; border:1px solid var(--primary); color:var(--primary); border-radius:4px;">GPX</button>
                    <button style="flex:1; padding:8px; background:#1a1f28; border:1px solid var(--primary); color:var(--primary); border-radius:4px;">JSON</button>
                    <button style="flex:1; padding:8px; background:#1a1f28; border:1px solid var(--primary); color:var(--primary); border-radius:4px;">SHP (QGIS)</button>
                </div>
            </div>
        </div>
    </div>

    <div class="module" id="mod-service">
        <div class="mod-head" onclick="toggleMod(this)">
            <div class="mod-title"><i class="fas fa-tools mod-icon"></i> SERVIS &amp; ÚDRŽBA</div>
            <i class="fas fa-chevron-down mod-chevron"></i>
        </div>
        <div class="mod-body">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <span>MOTOHODINY:</span>
                <input type="number" id="eng-hours" value="0" style="width:100px; padding:5px; text-align:center" onchange="calcService()">
            </div>

            <div class="service-item">
                <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px;">
                    <span>První Olej (Záběh 50h)</span>
                    <span id="lbl-50" class="val-cell">50h zbývá</span>
                </div>
                <div style="height:6px; background:#222; border-radius:3px;"><div id="bar-50" style="width: 50%; height: 100%; background: var(--accent); transition: width 1s;"></div></div>
            </div>

            <div class="service-item" style="margin-top:15px;">
                <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px;">
                    <span>Motorový Olej + Filtr (100h)</span>
                    <span id="lbl-100" class="val-cell">100h zbývá</span>
                </div>
                <div style="height:6px; background:#222; border-radius:3px;"><div id="bar-100" style="width: 100%; height: 100%; background: var(--success); transition: width 1s;"></div></div>
                <div style="font-size:10px; color:#666; margin-top:3px;">Olej: <strong>SAE 10W-40</strong> (Objem: 2.2L)</div>
            </div>

            <div class="service-item" style="margin-top:15px;">
                <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px;">
                    <span>Hydraulika + Převody (500h)</span>
                    <span id="lbl-500" class="val-cell">500h zbývá</span>
                </div>
                <div style="height:6px; background:#222; border-radius:3px;"><div id="bar-500" style="width: 100%; height: 100%; background: var(--primary); transition: width 1s;"></div></div>
                <div style="font-size:10px; color:#666; margin-top:3px;">Převodovka: <strong>SAE 80W90</strong> (0.5L)</div>
            </div>

            <div class="alert-box" style="border-color:var(--accent); background:rgba(255,184,0,0.05);">
                <i class="fas fa-wrench alert-icon" style="color:var(--accent)"></i>
                <div>
                    <strong style="color:var(--accent)">UTAHOVACÍ MOMENTY [Zdroj: 6]</strong><br>
                    Nosič čepelí: <strong>160 Nm</strong><br>
                    Šrouby nožů: <strong>130 Nm</strong><br>
                    Nože: <strong>36 Nm</strong>
                </div>
            </div>
        </div>
    </div>

    <div class="module" id="mod-tele">
        <div class="mod-head" onclick="toggleMod(this)">
            <div class="mod-title"><i class="fas fa-microchip mod-icon"></i> LIVE TELEMETRIE</div>
            <i class="fas fa-chevron-down mod-chevron"></i>
        </div>
        <div class="mod-body">
            <canvas id="teleChart" style="width: 0px; height: 0px; margin-bottom: 20px; display: block; box-sizing: border-box;" height="0" width="0"></canvas>
            
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                <div>
                    <div style="font-size:10px; color:#666;">MOTOR RPM</div>
                    <div style="font-size:24px; font-family:'JetBrains Mono'; color:var(--primary)" id="val-rpm">3569</div>
                </div>
                <div>
                    <div style="font-size:10px; color:#666;">TEPLOTA EL.MOTORU</div>
                    <div style="font-size:24px; font-family:'JetBrains Mono'; color:var(--accent)" id="val-temp">68°C</div>
                </div>
                <div>
                    <div style="font-size:10px; color:#666;">ZATÍŽENÍ</div>
                    <div style="font-size:24px; font-family:'JetBrains Mono'; color:var(--purple)" id="val-load">49%</div>
                </div>
                <div>
                    <div style="font-size:10px; color:#666;">NAPĚTÍ (48V sys)</div>
                    <div style="font-size:24px; font-family:'JetBrains Mono'; color:var(--success)" id="val-volt">48.3V</div>
                </div>
            </div>
        </div>
    </div>

    <div class="module" id="mod-acc">
        <div class="mod-head" onclick="toggleMod(this)">
            <div class="mod-title"><i class="fas fa-plug mod-icon"></i> PŘÍSLUŠENSTVÍ</div>
            <i class="fas fa-chevron-down mod-chevron"></i>
        </div>
        <div class="mod-body">
            <div style="margin-bottom:15px; border-left:3px solid var(--primary); padding-left:10px;">
                <strong style="color:var(--text-bright)">MiXTY Postřikovač</strong><br>
                <small style="color:var(--text-muted)">100L nádrž, 3 trysky, Elektrický pohon. Ideální pro vinice.</small>
            </div>
            <div style="margin-bottom:15px; border-left:3px solid var(--accent); padding-left:10px;">
                <strong style="color:var(--text-bright)">Flex Cut (420mm)</strong><br>
                <small style="color:var(--text-muted)">Boční sečení podél zdí/plotů. 2 nože. Automatická výška.</small>
            </div>
            <div style="margin-bottom:15px; border-left:3px solid var(--success); padding-left:10px;">
                <strong style="color:var(--text-bright)">Flex Trimmer (Struna)</strong><br>
                <small style="color:var(--text-muted)">Pro citlivé překážky. 1kW el. motor. 30-200mm výška.</small>
            </div>
            <div style="border-left:3px solid #fff; padding-left:10px;">
                <strong style="color:var(--text-bright)">Sněhová Radlice (135cm)</strong><br>
                <small style="color:var(--text-muted)">Vyžaduje zadní zvedací systém (80kg nosnost).</small>
            </div>
        </div>
    </div>

    <div class="ai-overlay" id="aiOverlay">
        <div style="padding:15px; border-bottom:1px solid var(--purple); background:#1a0b2e; display:flex; justify-content:space-between; align-items:center;">
            <strong style="color:var(--purple)"><i class="fas fa-brain"></i> NEURAL CORE (Zdroje 1-8)</strong>
            <i class="fas fa-times" style="color:#fff; font-size:20px;" onclick="toggleAI()"></i>
        </div>
        <div id="ai-chat-body" class="ai-content">
            <div class="ai-msg bot">
                Mám indexovaná všechna data z manuálů. Zeptejte se na: <br>
                <strong>"Olej"</strong>, <strong>"Kód 107"</strong>, <strong>"Svah"</strong> nebo <strong>"CZEPOS"</strong>.
            </div>
        </div>
        <div style="padding:15px; background:var(--bg-deep); border-top:1px solid #333; display:flex; gap:10px;">
            <input type="text" id="ai-input" placeholder="Zadejte dotaz..." style="flex:1; padding:12px;" onkeypress="if(event.key==='Enter') sendAI()">
            <button onclick="sendAI()" style="width:50px; background:var(--purple); border:none; border-radius:6px; color:#fff;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div class="fab-stack">
        <div class="fab fab-ai" onclick="toggleAI()"><i class="fas fa-robot"></i></div>
    </div>

    <!-- Aplikační logika -->
    <script src="js/app.js"></script>

</body>
</html>


